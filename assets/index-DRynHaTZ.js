(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();const i={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"d16daa7f-f1ac-4fea-bc25-4cb20c223c3d","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),Q=()=>fetch(`${i.baseUrl}/users/me`,{headers:i.headers}).then(m),O=()=>fetch(`${i.baseUrl}/cards`,{headers:i.headers}).then(m),X=({name:e,about:t})=>fetch(`${i.baseUrl}/users/me`,{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e,about:t})}).then(m),Y=e=>fetch(`${i.baseUrl}/users/me/avatar`,{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:e})}).then(m),Z=({name:e,link:t})=>fetch(`${i.baseUrl}/cards`,{method:"POST",headers:i.headers,body:JSON.stringify({name:e,link:t})}).then(m),ee=e=>fetch(`${i.baseUrl}/cards/${e}`,{method:"DELETE",headers:i.headers}).then(m),U=(e,t)=>fetch(`${i.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:i.headers}).then(m),te=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},c=null)=>{const r=te(),s=r.querySelector(".card__like-button"),a=r.querySelector(".card__control-button_type_delete"),u=r.querySelector(".card__image"),p=r.querySelector(".card__like-count");return p&&e.likes&&(p.textContent=e.likes.length),u.src=e.link,u.alt=e.name,r.querySelector(".card__title").textContent=e.name,e.likes&&e.likes.some(l=>l._id===c)&&s.classList.add("card__like-button_is-active"),c&&e.owner&&e.owner._id!==c?a.remove():n&&a.addEventListener("click",()=>n(r)),o&&s.addEventListener("click",()=>{const l=s.classList.contains("card__like-button_is-active");o(e._id,s,p,l)}),t&&u.addEventListener("click",()=>t({name:e.name,link:e.link})),r},F=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");f(t)}},h=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",F)},f=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",F)},oe=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{f(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&f(e)})},ne=(e,t,o,n)=>{const c=e.querySelector(`#${t.id}-error`);c.textContent=o,c.classList.add(n.errorClass),t.classList.add(n.inputErrorClass),j(e,n)},N=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);n.classList.remove(o.errorClass),n.textContent="",t.classList.remove(o.inputErrorClass),W(e,o)},re=(e,t,o)=>{if(t.validity.valid)N(e,t,o);else{const n=t.validity.patternMismatch?t.dataset.errorMessage:t.validationMessage;ne(e,t,n,o)}},ce=(e,t)=>Array.from(e.querySelectorAll(t.inputSelector)).some(n=>!n.validity.valid),j=(e,t)=>{const o=e.querySelector(t.submitButtonSelector);o.classList.add(t.inactiveButtonClass),o.disabled=!0},W=(e,t)=>{const o=e.querySelector(t.submitButtonSelector);o.classList.remove(t.inactiveButtonClass),o.disabled=!1},D=(e,t)=>{ce(e,t)?j(e,t):W(e,t)},se=(e,t)=>{Array.from(e.querySelectorAll(t.inputSelector)).forEach(n=>{n.addEventListener("input",()=>{re(e,n,t),D(e,t)})})},k=(e,t)=>{Array.from(e.querySelectorAll(t.inputSelector)).forEach(n=>{N(e,n,t)}),D(e,t)},ie=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{se(o,e)})},le=e=>{const t=e.map(o=>o.owner._id);return new Set(t).size},ae=e=>e.reduce((t,o)=>t+o.likes.length,0),ue=e=>{const t={};return e.forEach(o=>{o.likes.forEach(n=>{t[n._id]=(t[n._id]||0)+1})}),Math.max(...Object.values(t))},pe=e=>{const t={};e.forEach(r=>{t[r.owner._id]=(t[r.owner._id]||0)+r.likes.length});const o=Math.max(...Object.values(t)),n=Object.keys(t).find(r=>t[r]===o);return e.find(r=>r.owner._id===n).owner.name},de=e=>[...e].sort((o,n)=>n.likes.length-o.likes.length).slice(0,3).map(o=>o.name),H=document.querySelector(".places__list"),x=document.querySelector(".popup_type_edit"),S=x.querySelector(".popup__form"),J=S.querySelector(".popup__input_type_name"),V=S.querySelector(".popup__input_type_description"),E=document.querySelector(".popup_type_new-card"),y=E.querySelector(".popup__form"),_e=y.querySelector(".popup__input_type_card-name"),me=y.querySelector(".popup__input_type_url"),w=document.querySelector(".popup_type_image"),T=w.querySelector(".popup__image"),fe=w.querySelector(".popup__caption"),ye=document.querySelector(".profile__edit-button"),he=document.querySelector(".profile__add-button"),I=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),C=P.querySelector(".popup__form"),Se=C.querySelector(".popup__input"),b=S.querySelector(".popup__button"),q=y.querySelector(".popup__button"),L=C.querySelector(".popup__button"),z=document.querySelector(".popup_type_info"),Ce=z.querySelector(".popup__title"),ve=z.querySelector(".popup__text"),be=document.querySelector(".popup_type_info"),qe=document.querySelector(".header__logo");let g=null;const v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ie(v);const K=({name:e,link:t})=>{T.src=t,T.alt=e,fe.textContent=e,h(w)},Le=e=>{e.preventDefault();const t=b.textContent;b.textContent="Сохранение...",X({name:J.value,about:V.value}).then(o=>{I.textContent=o.name,B.textContent=o.about,f(x),k(v)}).catch(o=>{console.log(o)}).finally(()=>{b.textContent=t})},ge=e=>{e.preventDefault();const t=L.textContent;L.textContent="Сохранение...",Y(Se.value).then(o=>{M.style.backgroundImage=`url(${o.avatar})`,f(P),k(v)}).catch(o=>{console.log(o)}).finally(()=>{L.textContent=t})},ke=e=>{e.preventDefault();const t=q.textContent;q.textContent="Создание...";const o=_e.value,n=me.value;Z({name:o,link:n}).then(c=>{const r=$(c,{onPreviewPicture:K,onLikeIcon:(s,a,u,p)=>{U(s,p).then(d=>{a.classList.toggle("card__like-button_is-active"),u&&(u.textContent=d.likes.length)}).catch(d=>{console.log("Ошибка при обновлении лайка:",d)})},onDeleteCard:s=>{R(c._id,s)}},g);H.prepend(r),f(E),y.reset(),k(v)}).catch(c=>{console.log("Ошибка при добавлении карточки:",c)}).finally(()=>{q.textContent=t})},R=(e,t)=>{ee(e).then(()=>{t.remove()}).catch(o=>{console.log("Ошибка при удалении карточки:",o)})};S.addEventListener("submit",Le);y.addEventListener("submit",ke);C.addEventListener("submit",ge);ye.addEventListener("click",()=>{J.value=I.textContent,V.value=B.textContent,h(x)});M.addEventListener("click",()=>{C.reset(),h(P)});he.addEventListener("click",()=>{y.reset(),h(E)});const xe=document.querySelectorAll(".popup");xe.forEach(e=>{oe(e)});Promise.all([O(),Q()]).then(([e,t])=>{g=t._id,I.textContent=t.name,B.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{H.append($(o,{onPreviewPicture:K,onLikeIcon:(n,c,r,s)=>{U(n,s).then(a=>{c.classList.toggle("card__like-button_is-active"),r&&(r.textContent=a.likes.length)}).catch(a=>{console.log("Ошибка при обновлении лайка:",a)})},onDeleteCard:n=>{R(o._id,n)}},g))})}).catch(e=>{console.log(e)});const Ee=()=>{O().then(e=>{const t=le(e),o=ae(e),n=ue(e),c=pe(e),r=de(e),s=document.querySelector(".popup__content_content_info"),a=document.getElementById("popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0),u=document.getElementById("popup-info-user-preview-template").content.querySelector(".popup__list-item_type_badge").cloneNode(!0),p=s.querySelector(".popup__info"),d=s.querySelector(".popup__list");p.innerHTML="",d.innerHTML="";const l=Array.from({length:4},()=>a.cloneNode(!0));l[0].querySelector(".popup__info-term").textContent="Всего пользователей",l[0].querySelector(".popup__info-description").textContent=t,l[1].querySelector(".popup__info-term").textContent="Всего лайков",l[1].querySelector(".popup__info-description").textContent=o,l[2].querySelector(".popup__info-term").textContent="Максимально лайков от одного",l[2].querySelector(".popup__info-description").textContent=n,l[3].querySelector(".popup__info-term").textContent="Чемпион лайков",l[3].querySelector(".popup__info-description").textContent=c;const G=Math.min(3,r.length);for(let _=0;_<G;_++){const A=u.cloneNode(!0);A.textContent=r[_],d.append(A)}Ce.textContent="Статистика карточек",l.forEach(_=>{p.append(_)}),ve.textContent="Популярные карточки:",popularCardsList.forEach(_=>{d.append(_)})}).catch(e=>{console.log(e)})};qe.addEventListener("click",()=>{h(be),Ee()});
